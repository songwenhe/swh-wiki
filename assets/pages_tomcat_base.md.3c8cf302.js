import{_ as s,c as a,o as n,Q as l}from"./chunks/framework.8dca3095.js";const m=JSON.parse('{"title":"tomcat基础","description":"","frontmatter":{"title":"tomcat基础","order":1},"headers":[],"relativePath":"pages/tomcat/base.md","lastUpdated":1681724032000}'),o={name:"pages/tomcat/base.md"},t=l(`<h2 id="tomcat-的配置" tabindex="-1">tomcat 的配置 <a class="header-anchor" href="#tomcat-的配置" aria-label="Permalink to &quot;tomcat 的配置&quot;">​</a></h2><h3 id="配置文件路径" tabindex="-1">配置文件路径 <a class="header-anchor" href="#配置文件路径" aria-label="Permalink to &quot;配置文件路径&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">/tomcat/conf/server.xml</span></span></code></pre></div><h3 id="tomcat-的启动和关闭" tabindex="-1">tomcat 的启动和关闭 <a class="header-anchor" href="#tomcat-的启动和关闭" aria-label="Permalink to &quot;tomcat 的启动和关闭&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">/tomcat/bin/startup.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#启动tomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">/tomcat/bin/shutdown.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#关闭tomcat</span></span></code></pre></div><h3 id="tomcat-目录结构" tabindex="-1">tomcat 目录结构 <a class="header-anchor" href="#tomcat-目录结构" aria-label="Permalink to &quot;tomcat 目录结构&quot;">​</a></h3><table><thead><tr><th>/bin</th><th>存放 tomcat 管理脚本</th></tr></thead><tbody><tr><td>/conf</td><td>配置文件路径</td></tr><tr><td>/logs</td><td>日志目录</td></tr><tr><td>/webapps</td><td>站点目录</td></tr><tr><td>/lib tomcat</td><td>依赖，.jar 结尾</td></tr><tr><td>/temp</td><td>临时目录</td></tr><tr><td>/work</td><td>tomcat 运行代码的编译临时目录</td></tr></tbody></table><h3 id="tomcat配置systemctl服务" tabindex="-1">tomcat配置systemctl服务 <a class="header-anchor" href="#tomcat配置systemctl服务" aria-label="Permalink to &quot;tomcat配置systemctl服务&quot;">​</a></h3><p>新建tomcat.service文件：vim /lib/systemd/system/tomcat.service</p><p>写入以下代码</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">Unit</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">Description</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">The</span><span style="color:#A6ACCD;"> tomcat web server by songwenhe </span><span style="color:#676E95;font-style:italic;">#描述</span></span>
<span class="line"><span style="color:#A6ACCD;">After</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">network.target</span><span style="color:#A6ACCD;"> nss-lookup.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">Service</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">Type</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">forking</span></span>
<span class="line"><span style="color:#A6ACCD;">EnvironmentFile</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/etc/default/tomcat</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#环境变量文件</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStart</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/export/server/tomcat/bin/startup.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#启动</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStop</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/export/server/tomcat/bin/shutdown.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#关闭</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecReload</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/export/server/tomcat/bin/shutdown.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sleep</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/export/server/tomcat/bin/startup.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#重启</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">Install</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">WantedBy</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">multi-user.target</span></span></code></pre></div><p>配置tomcat环境变量文件。$JAVA_HOME前面的环境变量是系统的环境变量</p><p>用echo $PATH输出后直接复制进去</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">JAVA_HOME</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/export/server/jdk</span></span>
<span class="line"><span style="color:#A6ACCD;">PATH</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/.nvm/nvm-0.39.1/versions/node/v8.</span><span style="color:#F78C6C;">16.0</span><span style="color:#C3E88D;">/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/export/server/jdk/bin:</span><span style="color:#A6ACCD;">$JAVA_HOME</span><span style="color:#C3E88D;">/bin</span></span></code></pre></div><p>此时就可使用systemctl 去管理tomcat服务了</p><h3 id="tomcat管理端" tabindex="-1">tomcat管理端 <a class="header-anchor" href="#tomcat管理端" aria-label="Permalink to &quot;tomcat管理端&quot;">​</a></h3><p>无法访问时根据提示修改规则 /tomcat/conf/tomcat-users.xml</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">role</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rolename</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">manager-gui</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">role</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rolename</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">admin-gui</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">user</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">username</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tomcat</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s3cret</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">roles</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">manager-gui</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">user</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">username</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tomcat</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s3cret</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">roles</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">admin-gui</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">/&gt;</span></span></code></pre></div><p>修改后还是无法访问管理端，是因为tomcat8.5之后，就只允许本地访问管理端，到webapps目录下</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">find</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">context.xml</span></span>
<span class="line"><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">/examples/META-INF/context.xml</span></span>
<span class="line"><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">/host-manager/META-INF/context.xml</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">##</span></span>
<span class="line"><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">/docs/META-INF/context.xml</span></span>
<span class="line"><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">/manager/META-INF/context.xml</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">##</span></span></code></pre></div><p>修改./host-manager/META-INF/context.xml和./manager/META-INF/context.xml，这两个文件需要修改的地方是一样的</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">Valve</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">className</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">org.apache.catalina.valves.RemoteAddrValve</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">allow</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127\\.\\d+\\.\\d+\\.\\d+|::1|0:0:0:0:0:0:0:1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span></code></pre></div><p>将 127 改成 \\d+ , 运行以下代码</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s#127#\\\\d+#g</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./host-manager/META-INF/context.xml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./manager/META-INF/context.xml</span></span></code></pre></div>`,24),p=[t];function e(c,r,y,D,F,i){return n(),a("div",null,p)}const d=s(o,[["render",e]]);export{m as __pageData,d as default};
