---
title: shell
order: 2
---

# shell

```shell
command & #直接让作业进入后台运行
```

```shell
ctrl + z #将当前的作业切换到后台
```

```shell
job # 查看后台作业状态
```

```shell
fg %n #让后台的作业n切换到前台来
```

```shell
bg %n #让前台运行的作业到后台运行
```

```
kill %n
```

​ 移除指定的作业 n

​ n 为 jobs 命令查看到的编号，不是进程 id

​ 通过 jobs 来管理作业，当前终端的作业在其他终端不可见。

## 正则表达式

### 基本正则表达式 BRE

| ^      | 尖角号，用于模式的最左侧，如"^osdboy"，匹配以 oldbody 单词开头的行         |
| ------ | -------------------------------------------------------------------------- |
| $      | 美元符，用于模式的最右侧，如"osdboy$"，匹配以 oldbody 单词结尾的行         |
| ^$     | 组合符，表示空行                                                           |
| .      | 匹配任意一个且只有一个字符，不能匹配空行                                   |
| \      | 转义字符，让特殊含义的字符，现出原形，还原本意，例如`\.`代表小数点         |
| \*     | 匹配前一个字符（连续出现）0 次或 1 次以上，重复 0 次代表空，即匹配所有内容 |
| .\*    | 组合符，匹配所有内容                                                       |
| ^.\*   | 组合符，匹配任意多个字符开头的内容                                         |
| .\*$   | 组合符，匹配以任意多个字符结尾的内容                                       |
| [abc]  | 匹配[]集合内的任意一个字符，a 或 b 或 c，可以写成[a-c]                     |
| [^abc] | 匹配除了^后面的任意字符，a 或 b 或 c，^表示对[abc]的取反                   |

### 扩展正则表达式 ERE

| +        | 匹配前一个字符 1 次或多次               |
| -------- | --------------------------------------- |
| [:/]+    | 匹配括号内的":"或者"/"字符 1 次或者多次 |
| ?        | 匹配前一个字符 0 次或 1 次              |
| \        | 表示或者，同时过滤多个字符串            |
| ()       | 分组过滤，被括起来的内容表示一个整体    |
| `a{n,m}` | 匹配前一个字符最少 n 次，最多 m 次      |
| `a{n,}`  | 匹配前一个字符最少 n 次                 |
| `a{n}`   | 匹配前一个字符正好 n 次                 |
| `a{,m}`  | 匹配前一个字符最多 m 次                 |

## grep

文本搜索工具，根据用户指定的"模式（过滤条件）"对文本逐行进行匹配，打印匹配到的行

```shell
grep [options] [pattern] file  #options 是参数，pattern 是匹配模式
```

| options      | Description              |
| ------------ | ------------------------ |
| -v           | 排除匹配的结果，反向匹配 |
| -n           | 显示匹配行与行号         |
| -i           | 不区分大小写             |
| -c           | 只统计匹配的行数         |
| -E           | 使用 egrep 命令          |
| --color=auto | 为 grep 过滤结果添加颜色 |
| -w           | 只匹配过滤的单词         |
| -o           | 只输出匹配的内容         |

## sed

sed 是操作、过滤和转换文本内容的强大工具。常用功能包括结合正则表达式对文件实现快速增删改查，其中查询功能中最常用的两大功能是过滤、取行。

```shell
sed [options] [sed的内置命令] [file]
```

| options | Description                                          |
| ------- | ---------------------------------------------------- |
| -n      | 取消默认 sed 的输出，常与 sed 内置命令 p 一起用      |
| -i      | 直接将修改结果写入文件，不用-i，sed 修改的是内存数据 |
| -e      | 多次编辑，不需要管道符了                             |
| -r      | 支持正则扩展                                         |

sed 的`内置命令字符`用于对文件进行不同的操作功能，如对文件增删改查

sedd 常用`内置命令字符`

| a                 | append，对文本追加，在指定行后面添加一行/多行文本           |
| ----------------- | ----------------------------------------------------------- |
| d                 | delete，删除匹配行                                          |
| i                 | insert，表示插入文本，在指定行前添加一行/多行文本           |
| p                 | print，打印匹配行的内容，通常 p 与-n 一起用                 |
| s/正则/替换内容/g | 匹配正则内容，然后替换内容（支持正则），结尾 g 代表全局匹配 |

sed 匹配范围

| 空地址    | 全文处理                                                              |
| --------- | --------------------------------------------------------------------- |
| 单地址    | 指定文件某一行                                                        |
| /pattern/ | 被模式匹配到的每一行                                                  |
| 范围区间  | 10,20 10 到 20 行，10，+5 第 10 行向下 5 行，/pattern1/，/pattern2/   |
| 步长      | 1~2，表示 1、3、5、7、9 行，2~2 两个步长，表示 2、4、6、8、10、偶数行 |

## awk

```
awk options 'pattern[action]' file
```

## shell 命令合集

### 磁盘空间不足，需快速定位日志目录

```shell
du -x --max-depth=1 | sort -k1 -nr
```

du 命令中

-x 参数表示跳过其他文件系统

--max-depth 参数设置为 1，可以统计出跟目录下第一级目录中所有文件大小

sort 命令中

-k 参数指明具体按照哪一列进行排序

-n 参数表示只对数值进行排列

-r 参数表示反向排序

整体分析 sort 这一段命令的意思就是指定第一列并安装数据大小做反向排序

### 系统产生很多碎片文件，导致 inode 资源不足

```shell
find -type f | awk -F / -v OFS=/ '{$NF="";dir[$0]++}END{for(i in dir)print dir[i]" "i}' | sort -k1 -nr | head
```

find 命令通过-type-f 参数查找指定文件类型的文件，然后将查找结果通过管道符传递给 awk -F/指定处理文件时字符串之间以/进行分割，-v OPS=/表示文件显示结果时以/进行分割展示，awk 命令整体规则而言有一个{}END{}格式，面前的{}表示行处理操作，END{}表示行处理后需要进行整体结果行处理操作逻辑中，设置$NF 为空表示将每一行的文件名信息去除，只保留目录路径，dir 是一个自增数组，用于统计结果最后通过 for 循环进行遍历输出 dir 关联数组中所有行信息

#### 批量查找文件作内容替换

```shell
find ./-type f -name consumer.xml -exec sed -i"s/aaaaaa/bbbbbb/g"{}\
```

find 命令中

-name 参数指定查找的文件名

-exec 参数将查找到的内容传递给下一个命令去继续执行相关逻辑

sed 命令主要对文件内容进行替换，这里会将 consumer 文件中的 aaaaaa 替换成 bbbbbb
